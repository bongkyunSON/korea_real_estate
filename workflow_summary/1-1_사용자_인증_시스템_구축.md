# 1-1: 사용자 인증 시스템 구축 (feat. 주니어 개발자 성장기)

시니어 개발자로서, 주니어인 당신과 함께 우리 프로젝트의 '정문'을 만드는 과정을 기록합니다. 단순히 코드를 짜는 것을 넘어, '왜' 이렇게 만들어야 하는지, 그리고 어떤 문제를 만나고 어떻게 해결했는지에 대한 생생한 경험을 담았습니다.

---

## 목표: 우리 서비스의 '출입증 발급 시스템' 만들기

모든 서비스의 시작은 '회원가입'과 '로그인'입니다. 우리는 JWT(JSON Web Token)라는 표준 기술을 사용해서, 마치 놀이공원의 '자유이용권'처럼 안전하고 신뢰할 수 있는 '출입증' 발급 시스템을 구축하는 것을 목표로 삼았습니다.

### Step 1: 민감한 정보는 '비밀금고'에 보관하기 (`core/config.py`)

- **우리가 한 일:** '자유이용권'을 위조하지 못하게 만드는 우리만의 '비밀 도장'(`SECRET_KEY`)과, 이용권의 '유효 시간'(`ACCESS_TOKEN_EXPIRE_MINUTES`) 같은 중요한 정보를 `.env` 라는 별도 파일에 보관하고, `config.py`를 통해 안전하게 불러오도록 설계했습니다.
- **주니어를 위한 핵심 개념:** 데이터베이스 비밀번호나 SECRET KEY 같은 민감 정보를 코드에 직접 쓰는 것은, 집 열쇠를 현관문 앞에 걸어두는 것과 같습니다. 설정을 코드와 분리하는 것은 보안의 가장 첫걸음입니다.

### Step 2: '자유이용권 발급기' 제작하기 (`core/security.py`)

- **우리가 한 일:** '비밀 도장'과 '유효 시간'을 재료로, `create_access_token`이라는 '자유이용권 발급기' 함수를 만들었습니다. 이 함수는 사용자의 이메일 정보를 담아 암호화된 출입증(토큰)을 뚝딱 만들어냅니다.
- **주니어를 위한 핵심 개념:** 보안 관련 기능(비밀번호 암호화, 토큰 생성)은 `security.py`처럼 한 곳에 모아두어야 '보안 전문가'가 관리하기 편하고, 실수를 줄일 수 있습니다.

### Step 3: API의 '주문서'와 '영수증' 양식 만들기 (`schemas/user.py`)

- **우리가 한 일:** Pydantic을 사용해 API가 소통할 데이터의 형식을 미리 정의했습니다.
    - **`UserCreate`**: 회원가입 시 손님(클라이언트)이 작성할 '주문서'.
    - **`Token`**: 로그인 성공 후 우리가 발행해 줄 '영수증'.
    - **`UserResponse`**: 손님에게 보여줄 '회원 카드' (비밀번호 같은 민감 정보는 제외).
- **주니어를 위한 핵심 개념:** 스키마를 미리 정의하는 것은, 레스토랑에서 주문 실수를 줄이기 위해 정해진 주문서 양식을 쓰는 것과 같습니다. 데이터가 약속된 형식으로만 오고 가도록 보장하여 안정성을 크게 높입니다.

### Step 4: 주방의 '본인 확인 담당' 만들기 (`crud/user.py`)

- **우리가 한 일:** 손님이 "나 OOO인데, 비밀번호는 이거야" 라고 했을 때, 주방(DB)의 회원 명부와 대조하여 본인이 맞는지 확인하는 `authenticate_user` 함수를 만들었습니다.
- **주니어를 위한 핵심 개념:** 데이터베이스와 직접 소통하며 데이터를 읽고, 쓰고, 검증하는 핵심 로직은 `crud` 폴더에 모아 '주방장'의 역할에만 집중하도록 합니다.

### Step 5: 레스토랑의 '안내 데스크'와 '보안 요원' 배치하기 (`routers/user.py`)

- **우리가 한 일:**
    1.  손님의 `/login` 요청을 직접 받는 '안내 데스크' API를 만들었습니다.
    2.  `/users/me` 처럼 출입증이 있는 손님만 들어올 수 있는 'VIP 구역'을 만들었습니다.
    3.  이 VIP 구역 입구를 지키며 손님의 출입증을 검사하는 `get_current_user` 라는 든든한 '보안 요원'을 배치했습니다.
- **주니어를 위한 핵심 개념:** `routers`는 손님의 다양한 요청(URL)에 따라 적절한 담당자(CRUD 함수, 보안 요원)에게 안내해주는 '지배인'의 역할을 합니다.

---

## 주니어와 함께한 버그 사냥 일지 🐾

"시니어, 코드는 완벽한데 왜 안되죠?" 이 질문은 모든 주니어의 성장을 위한 최고의 질문입니다. 우리는 이 '완벽해 보이는' 코드 뒤에 숨어있던 수많은 버그를 함께 잡았습니다.

- **사건 #1: `ModuleNotFoundError`**
    - **증상:** "models 모듈을 찾을 수 없습니다."
    - **원인:** 레스토랑 건물 밖(프로젝트 루트)에서 직원을 찾으려고 했던 것.
    - **해결:** 레스토랑 안(백엔드 폴더)으로 직접 들어가서(`cd`) 직원을 찾아 문제를 해결.

- **사건 #2: `404 Not Found` (로그인 시)**
    - **증상:** "로그인 API를 찾을 수 없습니다."
    - **원인:** 레스토랑 주소가 `/api/login`으로 바뀌었는데, 안내 데스크의 내부 연락망(`tokenUrl`)에는 옛날 주소 `login`이 적혀있었음.
    - **해결:** 내부 연락망의 주소를 새 주소로 업데이트하여 해결.

- **사건 #3: `422 Unprocessable Entity`**
    - **증상:** "보내주신 주문서 양식이 이상해서 처리할 수 없습니다."
    - **원인:** 손님은 '일반 종이 주문서'(Form 데이터)를 냈는데, 우리는 '고급 양피지 주문서'(JSON)만 기다리고 있었음.
    - **해결:** 우리 API가 '일반 종이 주문서'도 받을 수 있도록 `OAuth2PasswordRequestForm`으로 변경하여 해결.

- **사건 #4: `AttributeError: '...email'`**
    - **증상:** "주문서에 'email' 항목이 없는데요?"
    - **원인:** '일반 종이 주문서'에는 손님 이름이 `username`으로 적혀있는데, 우리가 자꾸 `email` 항목을 찾으려고 했음.
    - **해결:** `form_data.username`으로 올바르게 수정하여 최종 해결.

이 험난한 디버깅 과정 덕분에, 우리는 단순한 기능 완성을 넘어 FastAPI 인증 시스템의 깊은 동작 원리까지 함께 배울 수 있었습니다. 이것이야말로 진짜 '성장'이죠!
